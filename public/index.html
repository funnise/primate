<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Primarteエキスパートコース選択</title>
    <!-- update the version number as needed -->
    <script defer src="/__/firebase/6.0.2/firebase-app.js"></script>
    <script src="https://apis.google.com/js/client.js?onload=init">
    </script>
    <!-- initialize the SDK after all desired features are loaded -->
    <script defer src="/__/firebase/init.js"></script>
    <script src="https://d.line-scdn.net/liff/1.0/sdk.js"></script>
    <link rel="stylesheet" href='./css/index.css'>
  </head>
  <body>
  <h1>下記のボタンから受講したいパンの種類を選択してください</h1>
    <ul class="SelectPane">
      <li><button onClick="makeApiCall('菓子パン')" >菓子パン</button></li>
      <li><button onClick="makeApiCall('菓子パン')">ロールパン</button></li>
      <li><button onClick="makeApiCall('食パン')">食パン</button></li>
      <li><button onClick="makeApiCall('調理パン')" >調理パン</button></li>
      <li><button onClick="makeApiCall('デニッシュ')">デニッシュ</button></li>
      <li><button onClick="makeApiCall('ハードパン')">ハードパン</button></li>
      <li><button onClick="makeApiCall('自家製酵母')">自家製酵母</button></li>
      <li><button onClick="makeApiCall('限定')">限定パン</button></li>
    </ul>
    <form> 
    <button onClick="sendMessage()">クリア</button><br>
    <button onClick="sendMessage()">Close&Message</button><br>
   <div class="col-lg-12" id="list">
        <!-- Insert my list here -->                              
   </div>
   </form>
    <script>
       var userId='';
       function handleClientLoad() {
        gapi.load('client:auth2', initClient);
      }
      function initClient() {
        CLIENT_ID='*';
        API_KEY = '*';
        var SCOPE = 'https://www.googleapis.com/auth/spreadsheets';
        gapi.client.init({
          'apiKey': API_KEY,
          'clientId': CLIENT_ID,
          'scope': SCOPE,
          'discoveryDocs': ['https://sheets.googleapis.com/$discovery/rest?version=v4'],
       }).then(function() {

      });
    }
     function makeApiCall(genre){
        var params = {
          spreadsheetId:'1LTatslyO6tuU8DEJmvBhxtbHGNtfP-pz4LLar40UVXE',  
          range: 'アイテムリスト!A1:G100',
        };
          var request = gapi.client.sheets.spreadsheets.values.get(params);
          var reulst = request.then(function(response) {
          var resultSet = response.result.values;
        for (var i=1;i<resultSet.length;i++) {
          var listDiv = document.getElementById('list');
        
          if(resultSet[i][3]==='TRUE'&&resultSet[i][5]===genre){
             var parent=document.createElement('div');
             parent.className = 'parent';
             var child=document.createElement('div');
              child.className = 'child'
              var Img=document.createElement('div')
              var p=document.createElement('p');
              var p2=document.createElement('p');
              var p3=document.createElement('p');
              var button = document.createElement('button')
              Img.innerHTML=`<img src=${resultSet[i][4]}>`
              p.innerHTML ='アイテム名: '+ resultSet[i][1]   // Use innerHTML to set the text
              p2.innerHTML ='説明: '+  resultSet[i][2]
              p3.innerHTML ='アイテム番号: '+  i
              button.innerHTML='このアイテムを選択する'
              child.appendChild(Img)
              child.appendChild(p);  
              child.appendChild(p2); 
              child.appendChild(p3); 
              child.appendChild(button); 
              parent.append(child)
              listDiv.appendChild(parent);
              }
             }
        }, function(reason) {
          console.error('error: ' + reason.result.error.message);
        })
      }
      function sendMessage(){
        liff.sendMessages([
          { type:'text',
            text:'My LINE_ID is '+userId+'\n'+'SELECTED Item is'+document['line']['item_1'] }
        ])
        .then(() => {
          console.log('message sent');
          liff.closeWindow();
        })
        .catch((err) => {
          console.log('error', err); });
      }
      </script>
      <script src="https://apis.google.com/js/api.js"
        onload="this.onload=function(){};handleClientLoad();"
        onreadystatechange="if (this.readyState === 'complete') this.onload()" >
      </script>
    <script>
      document.addEventListener('DOMContentLoaded', function() {//元はDOMContentLoaded
        try {
          //let app = firebase.app();
          //let features = ['auth', 'database', 'messaging', 'storage'].filter(feature => typeof app[feature] === 'function');
          liff.init(
            data => {
              // Now you can call LIFF API
              userId = data.context.userId;
              document['line']['lineid']['value']=userId;//LINE IDの格納NG
            },
            err => {}
          );
        } catch (e) { console.error(e);}
      });
    </script>
  </body>
</html>



