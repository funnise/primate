<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Primarteエキスパートコース選択</title>
    <!-- update the version number as needed -->
    <script defer src="/__/firebase/6.0.2/firebase-app.js"></script>
    <script src="https://apis.google.com/js/client.js?onload=init">
    </script>
    <!-- initialize the SDK after all desired features are loaded -->
    <script defer src="/__/firebase/init.js"></script>
    <script src="https://d.line-scdn.net/liff/1.0/sdk.js"></script>
  </head>
  <body>
  下記のフォームからアイテムを選択してください。(表示時にapiも叩く)
  <form name="line">
    <ul class="SelectPane">
      <li><button onClick="initClient()" >菓子パン</button></li>
      <li><button>ロールパン</button></li>
      <li><button>食パン</button></li>
      <li><button>調理パン</button></li>
      <li><button>デニッシュ</button></li>
      <li><button>ハードパン</button></li>
      <li><button>自家製酵母</button></li>
      <li><button>限定パン</button></li>
    </ul>
    <input name="lineid" value="" placeholder="id"><br>
    <select name="item_1"> <option value="なし">（アイテム1）</option></select><br>
    <select name="item_2"><option value="なし">（アイテム2）</option> </select><br>
    <div class="col-lg-12" id="list-puntate">
        <!-- Insert my list here -->                              
    </div>
  </form>
    <button onClick="sendMessage()">Close&Message</button><br>
    <script>
       var userId='';
       function handleClientLoad() {
        gapi.load('client:auth2', initClient);
      }

      function initClient() {
        CLIENT_ID='**.com';
        API_KEY = '**';
        var SCOPE = 'https://www.googleapis.com/auth/spreadsheets';
        gapi.client.init({
          'apiKey': API_KEY,
          'clientId': CLIENT_ID,
          'scope': SCOPE,
          'discoveryDocs': ['https://sheets.googleapis.com/$discovery/rest?version=v4'],
       }).then(function() {
        makeApiCall('菓子パン')
      });
    }
     function makeApiCall(genre){
        var params = {
          spreadsheetId:'1LTatslyO6tuU8DEJmvBhxtbHGNtfP-pz4LLar40UVXE',  
          range: 'アイテムリスト!A1:G100',
        };
          var request = gapi.client.sheets.spreadsheets.values.get(params);
          var reulst = request.then(function(response) {
          var resultSet = response.result.values;
          document.line.item_1.length = resultSet.length;
          var listDiv = document.getElementById('list-puntate');
          var div=document.createElement('div');
        for (var i=1;i<resultSet.length;i++) {
          if(resultSet[i][3]==='TRUE'&&resultSet[i][5]===genre){
          var div2=document.createElement('div');
              var Img=document.createElement('div')
              var p=document.createElement('p');
              var p2=document.createElement('p');
              var p3=document.createElement('p');
              var button = document.createElement('button')
              Img.innerHTML=`<img src=${resultSet[i][4]}>`
              p.innerHTML ='アイテム名: '+ resultSet[i][1]   // Use innerHTML to set the text
              p2.innerHTML ='説明: '+  resultSet[i][2]
              p3.innerHTML ='アイテム番号: '+  i
              button.innerHTML='このアイテムを選択する'
               div2.appendChild(Img)
               div2.appendChild(p);  
               div2.appendChild(p2); 
               div2.appendChild(p3); 
               div2.appendChild(button); 
               div.append(div2)
              }
             }
          listDiv.appendChild(div);
        }, function(reason) {
          console.error('error: ' + reason.result.error.message);
        })
      }
      function test(){
        window.alert('test')
      }
    
      function sendMessage(){
        liff.sendMessages([
          { type:'text',
            text:'My LINE_ID is '+userId+'\n'+'SELECTED Item is'+document['line']['item_1'] }
        ])
        .then(() => {
          console.log('message sent');
          liff.closeWindow();
        })
        .catch((err) => {
          console.log('error', err); });
      }
     
      </script>
      <script src="https://apis.google.com/js/api.js"
        onload="this.onload=function(){};handleClientLoad();"
        onreadystatechange="if (this.readyState === 'complete') this.onload()" >
      </script>
    <script>
      document.addEventListener('DOMContentLoaded', function() {//元はDOMContentLoaded
        try {
          //let app = firebase.app();
          //let features = ['auth', 'database', 'messaging', 'storage'].filter(feature => typeof app[feature] === 'function');
          liff.init(
            data => {
              // Now you can call LIFF API
              userId = data.context.userId;
              document['line']['lineid']['value']=userId;//LINE IDの格納NG
            },
            err => {}
          );
        } catch (e) { console.error(e);}
      });
    </script>
  </body>
</html>



